"use strict";(globalThis.webpackChunkweb_stories_wp=globalThis.webpackChunkweb_stories_wp||[]).push([[6736],{42607:(e,t,a)=>{a.r(t),a.d(t,{default:()=>Ae});var n=a(67294),r=(a(41792),a(69845)),i=a(72443),o=a(21530),s=a(12788),l=a(84967),c=a(36823),d=a(84705),u=a(55571),p=a(3961),m=a(46315),g=a(12161),h=a(59470),f=a(28395),y=a(80852),b=a(28154),w=a(4063),E=a(60641),_=a(36382),C=a(71028),x=a(6992),k=a(72165),v=a(25733),I=a(47718),T=a(69812),M=a(30540);const D=function DeleteDialog({mediaId:e,type:t,onClose:a}){const{actions:{deleteMedia:i}}=(0,v.useAPI)(),{showSnackbar:o}=(0,C.useSnackbar)(),{deleteMediaElement:s}=(0,I.useLocalMedia)((({actions:{deleteMediaElement:e}})=>({deleteMediaElement:e}))),{deleteElementsByResourceId:l}=(0,T.useStory)((e=>({deleteElementsByResourceId:e.actions.deleteElementsByResourceId}))),d=(0,r.useCallback)((async()=>{a();try{await i(e),s({id:e}),l({id:e})}catch(e){(0,_.trackError)("local_media_deletion",e.message),o({message:(0,c.__)("Failed to delete media item.","web-stories"),dismissible:!0})}}),[i,s,l,e,a,o]),u=(0,c.__)("Delete Image?","web-stories"),p=(0,c.__)("Delete Video?","web-stories"),m=(0,c.__)("You are about to permanently delete this image from your site. The image will appear broken in any content that uses it.","web-stories"),g=(0,c.__)("You are about to permanently delete this video from your site. The video will appear broken in any content that uses it.","web-stories");return n.createElement(M.default,{isOpen:!0,onClose:a,title:"image"===t?u:p,secondaryText:(0,c.__)("Cancel","web-stories"),onPrimary:d,primaryText:(0,c.__)("Delete","web-stories"),maxWidth:512},n.createElement(x.Text.Paragraph,{size:k.TextSize.Small},"image"===t?m:g),n.createElement(x.Text.Paragraph,{size:k.TextSize.Small,isBold:!0},(0,c.__)("This action can not be undone.","web-stories")))};var S=a(36313),R=a(83057),P=a(10693),j=a(13070);const N=(0,s.css)(["display:flex;width:","px;margin-right:28px;"],152),O=s.default.img.withConfig({displayName:"mediaEditDialog__Image",componentId:"sc-ctku7j-0"})(["",""],N),B=s.default.video.withConfig({displayName:"mediaEditDialog__Video",componentId:"sc-ctku7j-1"})(["",""],N),z=s.default.div.withConfig({displayName:"mediaEditDialog__DialogBody",componentId:"sc-ctku7j-2"})(["display:flex;justify-content:left;align-items:flex-start;"]),L=s.default.div.withConfig({displayName:"mediaEditDialog__MetadataTextContainer",componentId:"sc-ctku7j-3"})(["display:flex;flex-direction:column;margin:0 4px;"]),$=(0,s.default)(x.Text.Span).withConfig({displayName:"mediaEditDialog__DateText",componentId:"sc-ctku7j-4"})(["margin-bottom:8px;"]),A=(0,s.default)(j.default).withConfig({displayName:"mediaEditDialog__AssistiveTextArea",componentId:"sc-ctku7j-5"})(["margin:20px 0 4px;"]),V=(0,c.__)("Edit Image","web-stories"),q=(0,c.__)("Edit Video","web-stories"),U=(0,c.__)("Assistive text","web-stories"),F=(0,c.__)("Video description","web-stories"),W=(0,c.__)("Describe the appearance and function of the image. Leave empty if the image is purely decorative.","web-stories"),G=(0,c.__)("For indexability and accessibility. Include any burned-in text inside the video.","web-stories");const X=function MediaEditDialog({resource:e,onClose:t}){const{id:a,src:i,creationDate:o,width:s,height:l,type:d,alt:u,poster:p,mimeType:m}=e,{actions:{updateMedia:g}}=(0,v.useAPI)(),{updateMediaElement:h}=(0,I.useLocalMedia)((({actions:{updateMediaElement:e}})=>({updateMediaElement:e}))),{showSnackbar:f}=(0,C.useSnackbar)(),[y,b]=(0,r.useState)(u),w=(0,S.toDate)(o),E=(0,r.useCallback)((e=>{b(e.target.value)}),[]),T=(0,r.useCallback)((async()=>{try{await g(a,{altText:y}),h({id:a,data:{alt:y}}),t()}catch(e){(0,_.trackError)("local_media_edit",e.message),f({message:(0,c.__)("Failed to update, please try again.","web-stories"),dismissible:!0})}}),[y,a,t,f,g,h]),D="image"===d;return n.createElement(M.default,{isOpen:!0,onClose:t,title:D?V:q,secondaryText:(0,c.__)("Cancel","web-stories"),onPrimary:T,primaryText:(0,c.__)("Save","web-stories")},n.createElement(z,null,"image"===d?n.createElement(O,{src:(0,P.default)(152,e),alt:u,loading:"lazy",crossOrigin:"anonymous",decoding:"async"}):n.createElement(B,{key:i,crossOrigin:"anonymous",poster:p,preload:"metadata",muted:!0},n.createElement("source",{src:i,type:m})),n.createElement(L,null,(0,S.isValid)(w)&&n.createElement($,{size:k.TextSize.XSmall},(0,R.default)(/* translators: %s: upload date of media item. */ /* translators: %s: upload date of media item. */
(0,c.__)("Uploaded: %s","web-stories"),(0,S.formatDate)(o))),n.createElement(x.Text.Span,{size:k.TextSize.Small},(0,R.default)(/* translators: 1: image width. 2: image height. */ /* translators: 1: image width. 2: image height. */
(0,c.__)("%1$d x %2$d pixels","web-stories"),s,l)),n.createElement(A,{value:y,"aria-label":D?U:F,type:"text",placeholder:D?U:F,onChange:E}),n.createElement(x.Text.Paragraph,{size:k.TextSize.Small},D?W:G))))},H=(0,s.default)(w.ActionButton).withConfig({displayName:"dropDownMenu__MoreButton",componentId:"sc-1eq0xdj-0"})(["top:4px;right:4px;"]),Y=s.default.div.withConfig({displayName:"dropDownMenu__DropDownContainer",componentId:"sc-1eq0xdj-1"})(["margin-top:10px;"]),K=s.default.div.withConfig({displayName:"dropDownMenu__MenuContainer",componentId:"sc-1eq0xdj-2"})(["z-index:1;"]),J=(0,s.css)(["min-width:160px;margin-top:0;li{display:block;}"]),Q="edit",Z="delete";const ee=function DropDownMenu({resource:e,display:t,isMenuOpen:a,onMenuOpen:i,onMenuCancelled:o,onMenuSelected:s,setParentActive:l=m.noop}){const d=[{options:[{label:(0,c.__)("Edit meta data","web-stories"),value:Q},{label:(0,c.__)("Delete from library","web-stories"),value:Z}]}],[u,w]=(0,r.useState)(!1),[_,C]=(0,r.useState)(!1),x=(0,r.useRef)(),k=(0,r.useCallback)((()=>{o(),x.current?.focus(),l()}),[o,l]),{canTranscodeResource:v}=(0,b.useLocalMedia)((({state:{canTranscodeResource:e}})=>({canTranscodeResource:e}))),I=(0,r.useCallback)((()=>{w(!1),k()}),[w,k]),T=(0,r.useCallback)((()=>{C(!1),k()}),[C,k]),M=(0,r.useMemo)((()=>`list-${(0,p.default)()}`),[]),S=(0,r.useMemo)((()=>`button-${(0,p.default)()}`),[]);return v(e)&&n.createElement(K,null,x.current&&n.createElement(E.default,{target:x.current}),n.createElement(H,{ref:x,onClick:i,"aria-label":(0,c.__)("More","web-stories"),"aria-pressed":a,"aria-haspopup":!0,"aria-expanded":a,"aria-owns":a?M:null,id:S,$display:t,tabIndex:t||a?0:-1},n.createElement(g.default,null)),(t||a)&&n.createElement(h.default,{anchor:x,placement:f.Placement.BottomStart,isOpen:a},n.createElement(Y,null,n.createElement(y.default,{parentId:S,listId:M,handleMenuItemSelect:(e,t)=>{switch(s(),t){case Q:C(!0);break;case Z:w(!0)}},groups:d,onDismissMenu:k,hasMenuRole:!0,menuStylesOverride:J}))),u&&n.createElement(D,{mediaId:e.id,type:e.type,onClose:I}),_&&n.createElement(X,{resource:e,onClose:T}))};var te=a(37257),ae=a(91960);const ne=(0,s.default)(x.Text.Span).withConfig({displayName:"attribution__StyledText",componentId:"sc-dg18hp-0"})(["color:",";"],(({theme:e,active:t})=>(0,l.rgba)(e.colors.standard.white,t?1:.6))),re=s.default.a.withConfig({displayName:"attribution__Link",componentId:"sc-dg18hp-1"})(["display:block;position:absolute;left:0;bottom:0;width:100%;padding:8px;background-color:",";text-overflow:ellipsis;overflow:hidden;white-space:nowrap;text-decoration:none;"],(({theme:e,active:t})=>(0,l.rgba)(e.colors.bg.primary,t?.8:.6))),ie=({author:e,url:t})=>{const[a,i]=(0,r.useState)(!1),o=()=>i(!0),s=()=>i(!1);return n.createElement(re,{title:e,active:a,onPointerEnter:o,onFocus:o,onPointerLeave:s,onBlur:s,href:t,target:"_blank",rel:"noreferrer"},n.createElement(ne,{size:k.TextSize.XSmall},e))};var oe=a(5101),se=a(65742),le=a(39604),ce=a(37945),de=a(17989);function ue(){return ue=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},ue.apply(this,arguments)}const pe=(0,s.css)(["width:100%;cursor:pointer;transition:0.2s transform,0.15s opacity;border-radius:4px;opacity:0;object-fit:cover;"]),me=s.default.img.withConfig({displayName:"innerElement__Image",componentId:"sc-qkk7ov-0"})(["",""],pe),ge=s.default.video.withConfig({displayName:"innerElement__Video",componentId:"sc-qkk7ov-1"})([""," ",""],pe,(({showWithoutDelay:e})=>e?"opacity: 1;":"")),he=s.default.div.withConfig({displayName:"innerElement__DurationWrapper",componentId:"sc-qkk7ov-2"})(["position:absolute;bottom:8px;left:8px;background:",";border-radius:100px;height:18px;padding:0 6px;"],(({theme:e})=>e.colors.opacity.black64)),fe=s.default.div.withConfig({displayName:"innerElement__MuteWrapper",componentId:"sc-qkk7ov-3"})(["position:absolute;bottom:8px;right:8px;height:24px;width:24px;background:",";color:",";border-radius:100px;"],(({theme:e})=>e.colors.opacity.black64),(({theme:e})=>e.colors.fg.primary)),ye=(0,s.default)(x.Text.Span).attrs({size:k.TextSize.XSmall}).withConfig({displayName:"innerElement__Duration",componentId:"sc-qkk7ov-4"})(["color:",";display:block;"],(({theme:e})=>e.colors.fg.primary)),be=s.default.img.withConfig({displayName:"innerElement__CloneImg",componentId:"sc-qkk7ov-5"})(["opacity:0;width:",";height:",";position:absolute;"],(({width:e})=>`${e}px`),(({height:e})=>`${e}px`));const we=(0,r.memo)((function InnerElement({type:e,src:t,resource:a,alt:i,width:o,height:s,onClick:l,onLoad:c=m.noop,showVideoDetail:d,mediaElement:u,active:p,isMuted:g}){const h=(0,r.useRef)(null),f=(0,r.useRef)(null),{handleDrag:y,handleDrop:b}=(0,ce.useDropTargets)((({state:e,actions:t})=>({handleDrag:t.handleDrag,handleDrop:t.handleDrop,dropTargets:e.dropTargets,activeDropTargetId:e.activeDropTargetId})),((e,t)=>{if(f.current)return!1;if(null===f.current)return f.current=!1,!1;if(e?.dropTargets&&t?.dropTargets){const a=Object.keys(e.dropTargets),n=Object.keys(t.dropTargets);if(a.join()!==n.join())return!1}return e?.activeDropTargetId===t?.activeDropTargetId})),{setDraggingResource:w}=(0,ce.useDropTargets)((({actions:{setDraggingResource:e}})=>({setDraggingResource:e})));let E;(0,r.useEffect)((()=>{a.poster&&(h.current=a.poster)}),[a.poster]);const{lengthFormatted:_,poster:C,mimeType:x}=a,k=C??h.current,v=k||(0,P.default)(o,a),T={width:o,height:s,alt:i,crossOrigin:"anonymous"},M={...T,onLoad:()=>{u.current&&(u.current.style.opacity=1),c()},loading:"lazy",decoding:"async",draggable:!1},D={...M,onLoad:void 0},S={...M,src:v},R={...T,title:i,alt:null,loop:e===I.ContentType.Gif,muted:!0,preload:"metadata",poster:k,showWithoutDelay:p};if(e===I.ContentType.Image||e===I.ContentType.Sticker?(E=n.createElement(me,ue({key:t},S,{ref:u})),D.src=v):[I.ContentType.Video,I.ContentType.Gif].includes(e)&&(E=n.createElement(n.Fragment,null,C&&!p?n.createElement(me,ue({key:t},S,{ref:u})):n.createElement(ge,ue({key:t},R,{ref:u}),e===I.ContentType.Gif?a.output.src&&n.createElement("source",{src:a.output.src,type:a.output.mimeType}):n.createElement("source",{src:(0,P.default)(o,a),type:x})),e===I.ContentType.Video&&d&&_&&n.createElement(he,null,n.createElement(ye,null,_)),e===I.ContentType.Video&&d&&g&&n.createElement(fe,null,n.createElement(se.default,null))),D.src=C),!E)throw new Error("Invalid media element type.");const j=e===I.ContentType.Image?v:C;return n.createElement(n.Fragment,null,E,p&&n.createElement(de.default,{showIcon:!1}),n.createElement(le.default,{active:p,handleDrag:e=>{f.current||(oe.default.set(a.id,{url:v,type:"cached"}),w(a),f.current=!0),y(a,e.clientX,e.clientY)},handleDragEnd:()=>{b(a),f.current=!1},type:a.type,elementProps:{resource:a},onClick:l(j),cloneElement:be,cloneProps:D}))}));var Ee=a(58979),_e=a(25941),Ce=a(88348),xe=a(37075),ke=a(8092),ve=a(51093);const Ie=s.default.div.withConfig({displayName:"insertionMenu__DropDownContainer",componentId:"sc-xjd4tf-0"})(["margin-top:10px;min-width:160px;"]),Te=s.default.div.withConfig({displayName:"insertionMenu__MenuContainer",componentId:"sc-xjd4tf-1"})(["z-index:1;"]),Me=(0,s.css)(["min-width:160px;margin-top:0;li{display:block;}"]),De="insert",Se="addBackground";const Re=function InsertionMenu({resource:e,display:t,onInsert:a,width:i,index:o,isLocal:s=!1,setParentActive:l=m.noop,setParentInactive:d=m.noop}){const u=(0,r.useRef)(),[g,b]=(0,r.useState)(!1),E=(0,r.useCallback)((e=>{e.stopPropagation(),b(!0)}),[]),_=(0,r.useCallback)((()=>{b(!1),u.current?.focus(),l()}),[l]),{currentBackgroundId:C,combineElements:x}=(0,xe.default)((e=>({currentBackgroundId:e.state.currentPage?.elements?.[0]?.id,combineElements:e.actions.combineElements}))),{type:k,poster:v}=e,I=[{options:[{label:["image","gif"].includes(k)?(0,c.__)("Insert image","web-stories"):(0,c.__)("Insert video","web-stories"),value:De},{label:(0,c.__)("Add as background","web-stories"),value:Se}]}];(0,ke.default)({ref:u},[],3);const T=(0,ve.default)();(0,Ee.useKeyDownEffect)(s?null:u,"tab",T,[T]);const M=(0,r.useMemo)((()=>`list-${(0,p.default)()}`),[]),D=(0,r.useMemo)((()=>`button-${(0,p.default)()}`),[]);return n.createElement(Te,null,n.createElement(w.ActionButton,{ref:u,onClick:E,"aria-label":(0,c.__)("Open insertion menu","web-stories"),"aria-pressed":g,"aria-haspopup":!0,"aria-expanded":g,"aria-owns":g?M:null,id:D,$display:t,tabIndex:0===o?0:-1},n.createElement(_e.default,null)),g&&n.createElement(h.default,{anchor:u,placement:f.Placement.BottomStart,isOpen:g},n.createElement(Ie,null,n.createElement(y.default,{parentId:D,listId:M,handleMenuItemSelect:(t,n)=>{const r=v||(0,P.default)(i,e),o=(0,Ce.default)(e.type,{resource:e});switch(b(!1),n){case De:a(e,r);break;case Se:x({firstElement:o,secondId:C})}d()},groups:I,onDismissMenu:_,hasMenuRole:!0,menuStylesOverride:Me}))))};function Pe(){return Pe=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},Pe.apply(this,arguments)}const je=600,Ne=s.default.div.attrs((e=>({style:{width:e.width+"px",height:e.height+"px",margin:e.margin,backgroundColor:"transparent",color:"inherit",border:"none",padding:0}}))).withConfig({displayName:"mediaElement__Container",componentId:"sc-n7038j-0"})([""]),Oe=s.default.div.withConfig({displayName:"mediaElement__InnerContainer",componentId:"sc-n7038j-1"})(["position:relative;display:flex;margin-bottom:10px;background-color:",";"],(({theme:e,$baseColor:t})=>t||(0,l.rgba)(e.colors.standard.black,.3))),Be=(0,s.default)(u.Blurhash).withConfig({displayName:"mediaElement__BlurhashContainer",componentId:"sc-n7038j-2"})(["position:absolute !important;top:0;left:0;"]);function Element({index:e,resource:t,width:a,height:i,margin:o,onInsert:s,providerType:l,canEditMedia:u}){const{id:p,src:m,type:g,width:h,height:f,alt:y,isMuted:b,baseColor:w,blurHash:E}=t,{isCurrentResourceProcessing:_,isCurrentResourceUploading:C}=(0,I.useLocalMedia)((({state:e})=>({isCurrentResourceProcessing:e.isCurrentResourceProcessing,isCurrentResourceUploading:e.isCurrentResourceUploading}))),x=h&&f?h/f:1,k=a||i/x,v=i||k/x,T=(0,r.useRef)(),[M,D]=(0,r.useState)(!0),[S,R]=(0,r.useState)(!1),[P,j]=(0,r.useState)(!1),[N,O]=(0,r.useState)(!1),B=(0,r.useCallback)((()=>R(!0)),[]),z=(0,r.useCallback)((()=>R(!1)),[]),L=(0,r.useCallback)((()=>j(!0)),[]),$=(0,r.useCallback)((()=>j(!1)),[]),A=(0,r.useCallback)((()=>{j(!1),R(!1)}),[]),[V,q]=(0,r.useState)(null),U=(0,r.useRef)(S);U.current=S,(0,r.useEffect)((()=>{if(![I.ContentType.Video,I.ContentType.Gif].includes(g))return;const e=()=>{null!==V&&(clearTimeout(V),q(null))};if(!P)if(S){if(D(!1),T.current&&null===V){const e=setTimeout((()=>{U.current&&m&&T.current.play().catch(ae.noop)}),je);q(e)}}else D(!0),e(),T.current&&T.current?.pause&&m&&(T.current.pause(),T.current.currentTime=0);return e}),[P,S,g,m,V,q,U]);const F=(0,r.useCallback)((e=>()=>{s(t,e)}),[s,t]),W=S&&t.attribution?.author?.displayName&&t.attribution?.author?.url&&n.createElement(ie,{author:t.attribution.author.displayName,url:t.attribution.author.url}),G=(0,r.useRef)(),X=(0,r.useCallback)((()=>O(!0)),[]),H=!N&&!S;return n.createElement(Ne,{ref:G,"data-testid":`mediaElement-${g}`,"data-id":p,className:"mediaElement",width:k,height:v,margin:o,onPointerEnter:B,onFocus:B,onPointerLeave:z,onBlur:z,tabIndex:"-1"},n.createElement(Oe,{$baseColor:H&&w},n.createElement(we,{type:g,src:m,mediaElement:T,resource:t,alt:y,isMuted:b,width:k,height:v,onClick:F,onLoad:X,showVideoDetail:M,active:S}),W,H&&E&&n.createElement(Be,{hash:E,width:k,height:v,punch:1}),(!m||_(p)||C(p))&&n.createElement(d.LoadingBar,{loadingMessage:(0,c.__)("Uploading media…","web-stories")}),n.createElement(Re,{resource:t,display:S,onInsert:s,width:k,index:e,isLocal:"local"===l,setParentActive:B,setParentInactive:z}),"local"===l&&u&&n.createElement(ee,{resource:t,display:S,isMenuOpen:P,onMenuOpen:L,onMenuCancelled:$,onMenuSelected:A,setParentActive:B})))}const ze=(0,r.memo)((function MediaElement({providerType:e="local",canEditMedia:t=!1,...a}){const{isCurrentResourceProcessing:r,isCurrentResourceUploading:i}=(0,I.useLocalMedia)((({state:e})=>({isCurrentResourceProcessing:e.isCurrentResourceProcessing,isCurrentResourceUploading:e.isCurrentResourceUploading}))),{id:o}=a.resource;return r(o)||i(o)?n.createElement(te.default,{title:(0,c.__)("Uploading media…","web-stories")},n.createElement(Element,Pe({},a,{providerType:e,canEditMedia:t}))):n.createElement(Element,Pe({},a,{providerType:e,canEditMedia:t}))}));var Le=a(81024);const $e={maxPhotos:2},ContainerRenderer=({children:e,containerRef:t})=>n.createElement(Le.GalleryContainer,{ref:t},e),RowRenderer=({children:e})=>e;const Ae=function MediaGallery({resources:e,uploadingResources:t=[],onInsert:a,providerType:s,canEditMedia:l=!1}){const c=[...t.map((e=>({key:`uploading-${e.id}`,src:e.src,width:e.width,height:e.height,resource:e}))),...e.map((e=>({key:e.id,src:e.src,width:e.width,height:e.height,resource:e})))].map(((e,t)=>({...e,index:t}))),d=(0,r.useCallback)((({photo:e,layout:t})=>n.createElement(ze,{key:e.key,index:e.index,margin:"0px 0px 8px 0px",resource:e.resource,width:t.width,height:t.height,onInsert:a,providerType:s,canEditMedia:l})),[s,a,l]);return n.createElement("div",null,n.createElement(i.default,{layout:"rows",photos:c,renderPhoto:d,renderRowContainer:RowRenderer,renderContainer:ContainerRenderer,targetRowHeight:110,rowConstraints:$e,spacing:8,defaultContainerWidth:o.SIDEBAR_WIDTH}))}}}]);